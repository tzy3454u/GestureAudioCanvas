# Implementation Plan

## Tasks

- [x] 1. 再生時間倍率計算ロジックの動的化
- [x] 1.1 calculateDurationRate関数にキャンバス幅パラメータを追加する
  - 関数シグネチャを拡張し、第2引数としてキャンバス幅を受け取る
  - 基準距離をキャンバス幅の半分として動的に計算する
  - 固定の基準距離定数を削除する
  - キャンバス幅が0以下の場合のデフォルト値処理を追加する
  - _Requirements: 1.1, 1.2, 1.3, 1.4, 1.5_

- [x] 1.2 (P) インターフェース型定義を更新する
  - AudioProcessorHookインターフェースのcalculateDurationRateシグネチャを更新する
  - 既存のメソッド（calculatePitchRate、isReversePlayback）は変更しない
  - _Requirements: 3.1, 3.3_

- [x] 2. UI層からのキャンバス幅伝達
- [x] 2.1 メインページのジェスチャー完了ハンドラを更新する
  - calculateDurationRate呼び出し時にキャンバス幅定数を引数として渡す
  - 既存のジェスチャー検出フローは変更しない
  - ピッチ計算と再生方向判定の呼び出しは変更しない
  - _Requirements: 2.1, 2.2, 3.2_

- [x] 3. テストの更新
- [x] 3.1 ユニットテストを新しいシグネチャに更新する
  - calculateDurationRateのテストケースに第2引数を追加する
  - キャンバス幅の半分で倍率1.0を返すことを検証する
  - キャンバス幅と同じ距離で倍率2.0を返すことを検証する
  - キャンバス幅の1/4で倍率0.5を返すことを検証する
  - 距離0で倍率0を返すことを検証する
  - _Requirements: 1.2, 1.3, 1.4, 1.5_

- [x] 3.2 (P) 統合テストを更新する
  - 統合テストでのcalculateDurationRate呼び出しを更新する
  - ジェスチャー完了から再生までのフロー全体を検証する
  - _Requirements: 2.2_

- [x] 3.3 (P) ページコンポーネントのモック定義を更新する
  - モック関数のシグネチャを新しいAPIに合わせる
  - 既存のテストが正しく動作することを確認する
  - _Requirements: 3.1_

- [x] 4. 動作確認と統合検証
- [x] 4.1 エンドツーエンドの動作を確認する
  - アプリケーションを起動し、ジェスチャー操作で音声再生を確認する
  - キャンバス幅の半分の線で元の音声長さが再生されることを検証する
  - 異なる長さの線で再生時間が線形に変化することを検証する
  - ピッチ変換と再生方向が正常に動作することを確認する
  - _Requirements: 1.1, 1.2, 1.3, 1.4, 1.5, 2.2, 3.2, 3.3_

## Requirements Coverage

| Requirement | Task(s) |
|-------------|---------|
| 1.1 | 1.1, 4.1 |
| 1.2 | 1.1, 3.1, 4.1 |
| 1.3 | 1.1, 3.1, 4.1 |
| 1.4 | 1.1, 3.1, 4.1 |
| 1.5 | 1.1, 3.1, 4.1 |
| 2.1 | 2.1 |
| 2.2 | 2.1, 3.2, 4.1 |
| 2.3 | (将来対応 - Non-Goal) |
| 3.1 | 1.2, 3.3 |
| 3.2 | 2.1, 4.1 |
| 3.3 | 1.2, 4.1 |
