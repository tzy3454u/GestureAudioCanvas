# Implementation Plan

## Tasks

- [x] 1. プロジェクト基盤のセットアップ
- [x] 1.1 Next.jsプロジェクトの初期化と基本設定
  - Next.js + TypeScriptプロジェクトを作成する
  - 静的エクスポート設定（`output: 'export'`）を有効化する
  - MUIとEmotionの依存関係をインストールし、テーマプロバイダを設定する
  - Firebase SDKをインストールし、初期化ファイルを作成する
  - _Requirements: 9.1, 9.2, 9.3, 9.4, 9.5, 9.6_

- [x] 1.2 Firebase Hostingのセットアップ
  - Firebase CLIでプロジェクトを初期化する
  - Hosting設定でビルド出力ディレクトリを指定する
  - SPAリダイレクト設定を追加する
  - _Requirements: 10.1, 10.2, 10.3_

- [x] 2. 認証機能の実装
- [x] 2.1 認証状態管理の実装
  - Firebase Authenticationの初期化と認証状態監視を実装する
  - 認証状態をアプリ全体で共有するContextを作成する
  - ユーザー情報（uid、email）を保持する状態管理を実装する
  - _Requirements: 8.1_

- [x] 2.2 ログイン機能の実装
  - メールアドレスとパスワードによるログイン処理を実装する
  - ログインエラーのハンドリングとメッセージ表示を実装する
  - ログイン成功時のメイン画面へのリダイレクトを実装する
  - _Requirements: 8.2, 8.5, 8.7_

- [x] 2.3 ログイン画面UIの作成
  - メールアドレスとパスワードの入力フォームを作成する
  - ログインボタンと送信中状態の表示を実装する
  - 入力バリデーションとエラーメッセージ表示を実装する
  - _Requirements: 8.3, 8.7_

- [x] 2.4 認証ガードとルート保護の実装
  - 未認証ユーザーをログイン画面にリダイレクトするガードを実装する
  - 認証確認中のローディング表示を実装する
  - メイン画面へのアクセス制御を適用する
  - _Requirements: 8.4_

- [x] 2.5 ログアウト機能の実装
  - ヘッダーにログアウトボタンを配置する
  - ログアウト処理と状態クリアを実装する
  - ログアウト後のログイン画面リダイレクトを実装する
  - _Requirements: 8.6_

- [x] 3. 音声処理機能の実装
- [x] 3.1 (P) AudioContext管理の実装
  - Web Audio APIのAudioContext初期化を実装する
  - ブラウザ互換性対応（webkitAudioContext）を実装する
  - ユーザーインタラクション後の初期化タイミング制御を実装する
  - _Requirements: 1.3_

- [x] 3.2 (P) サイン波サンプル音源の生成
  - 5秒間の440Hzサイン波AudioBufferを生成する関数を実装する
  - サンプルレートに応じたサンプル数の計算を実装する
  - 生成した音源をロード可能な状態にする
  - _Requirements: 1.2_

- [x] 3.3 音声ファイルのロードとデコード
  - ファイル入力からArrayBufferを読み込む処理を実装する
  - AudioContextでArrayBufferをAudioBufferにデコードする
  - デコードエラーのハンドリングを実装する
  - _Requirements: 1.3, 1.6_

- [x] 3.4 逆再生用AudioBufferの生成
  - AudioBufferの各チャンネルデータを反転させる処理を実装する
  - 順再生用と逆再生用の両方のバッファを保持する状態管理を実装する
  - _Requirements: 5.1, 5.2_

- [x] 3.5 再生パラメータ計算の実装
  - 線の長さから再生時間倍率を算出する関数を実装する（20px = 元の長さ）
  - Y座標からピッチ倍率を算出する関数を実装する（0.25〜4.0倍）
  - 方向から再生方向（順/逆）を判定する関数を実装する
  - _Requirements: 4.1, 4.2, 4.3, 4.4, 5.1, 5.2, 6.1, 6.2, 6.3, 6.4_

- [x] 3.6 音声再生の実装
  - AudioBufferSourceNodeを作成して再生する処理を実装する
  - playbackRateでピッチと速度を設定する
  - 再生完了イベント（onended）のハンドリングを実装する
  - 再生中状態の管理を実装する
  - _Requirements: 7.1, 7.4_

- [x] 4. キャンバスとジェスチャー機能の実装
- [x] 4.1 キャンバス描画基盤の実装
  - HTML5 Canvas要素のレンダリングとサイズ管理を実装する
  - Canvas 2Dコンテキストの取得と保持を実装する
  - 有効/無効状態の視覚的表示を実装する
  - _Requirements: 2.1, 2.2, 2.3_

- [x] 4.2 ポインターイベント処理の実装
  - マウス/タッチのpointerdown、pointermove、pointerupイベントを処理する
  - キャンバス座標への変換処理を実装する
  - 描画中状態の管理を実装する
  - _Requirements: 3.1, 3.3_

- [x] 4.3 軌跡描画の実装
  - ドラッグ中のリアルタイム軌跡描画を実装する
  - 始点と終点の記録を実装する
  - 軌跡のパス配列を管理する
  - _Requirements: 3.2_

- [x] 4.4 ジェスチャーパラメータ算出の実装
  - 始点から終点までの直線距離を計算する
  - X方向の正負から再生方向を判定する
  - Y座標を正規化してピッチ倍率計算用の値を算出する
  - _Requirements: 4.1_

- [x] 4.5 キャンバスクリアと状態リセットの実装
  - 再生完了後にキャンバスをクリアする処理を実装する
  - 再生中の操作無効化を実装する
  - クリア後に再入力可能状態に遷移する
  - _Requirements: 7.2, 7.3, 7.4_

- [x] 5. 音声選択UIの実装
- [x] 5.1 音声ソース選択UIの作成
  - サンプル音源ボタンとファイル選択ボタンを配置する
  - 選択状態の視覚的フィードバックを実装する
  - ファイル入力のhidden inputとクリックトリガーを実装する
  - _Requirements: 1.1_

- [x] 5.2 ロード状態表示の実装
  - 音声ロード中のプログレス/スピナー表示を実装する
  - ロード完了後の状態表示を実装する
  - エラー時のメッセージ表示を実装する
  - _Requirements: 1.4, 1.5, 1.6_

- [x] 6. メイン画面の統合
- [x] 6.1 メインページのレイアウト構成
  - ヘッダー、音声選択、キャンバスの配置を実装する
  - 認証ガードでページを保護する
  - レスポンシブ対応のレイアウトを実装する
  - _Requirements: 1.1, 2.1, 8.4_

- [x] 6.2 音声選択からキャンバス有効化への連携
  - 音声ロード完了時にキャンバスを有効化する
  - 音声未選択時のキャンバス無効表示を実装する
  - 音声切り替え時の状態リセットを実装する
  - _Requirements: 1.5, 2.3_

- [x] 6.3 ジェスチャーから音声再生への連携
  - ジェスチャー完了時にパラメータを計算して再生をトリガーする
  - 再生完了時にキャンバスをクリアする
  - エラー発生時の通知を実装する
  - _Requirements: 7.1, 7.2, 7.3_

- [x] 7. 動作検証
- [x] 7.1 認証フローの検証
  - ログイン成功/失敗の動作を確認する
  - 未認証アクセス時のリダイレクトを確認する
  - ログアウト後の状態クリアを確認する
  - _Requirements: 8.1, 8.2, 8.3, 8.4, 8.5, 8.6, 8.7_

- [x] 7.2 音声処理フローの検証
  - サンプル音源の生成と再生を確認する
  - ファイルロードとデコードを確認する
  - ピッチ変更と逆再生の動作を確認する
  - _Requirements: 1.2, 1.3, 4.2, 4.3, 4.4, 5.1, 5.2, 6.1, 6.2, 6.3, 6.4_

- [x] 7.3 キャンバス操作フローの検証
  - 軌跡描画の動作を確認する
  - ジェスチャー完了から再生開始までの連携を確認する
  - 再生完了後のクリアと再入力可能状態への遷移を確認する
  - _Requirements: 2.1, 2.2, 2.3, 3.1, 3.2, 3.3, 7.1, 7.2, 7.3, 7.4_
